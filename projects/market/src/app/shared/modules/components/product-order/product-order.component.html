<div *ngIf="tradeOffer">
  <div class="product_side" *ngIf="orderStatus === 0">
    <div class="to_cart__wrap">
      <h3>Добавить товар в <a [routerLink]="['/cart']">корзину</a></h3>
      <ng-container *ngTemplateOutlet="product_side"></ng-container>
      <div class="to_cart__total_price">
        Товар не продается
      </div>
      <p class="to_cart__nds">Свяжитесь с поставщиком,<br> чтобы узнать детали</p>
    </div>
  </div>


  <div class="product_side" *ngIf="orderStatus === 1">
    <div class="to_cart__wrap">
      <h3>Добавить товар в <a [routerLink]="['/cart']">корзину</a></h3>
      <p class="to_cart__supplier" *ngIf="isProductPage">от {{tradeOffer?.supplier.name | abbreviatedBusinessName}}</p>
      <ng-container *ngTemplateOutlet="product_side"></ng-container>
      <div class="to_cart__total_price" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
        <span *ngIf="price" itemprop="price">{{price | marketMultiplier:'.01' | currencyPrice: tradeOffer.termsOfSale.price?.currencyCode}}</span>
        <span *ngIf="!price" itemprop="price">цена по запросу</span>
      </div>
      <p class="to_cart__nds">{{vatInfo}}</p>
      <p class="to_cart__low_price" *ngIf="isProductPage">НИЗКАЯ ЦЕНА</p>
      <div class="tooltip_wrap" *ngIf="tradeOffer.audience">
        <span class="tooltip"
              nz-tooltip
              nzTooltipTitle="Поставщик установил специальную выгодную цену для вас">Специальная цена</span>
      </div>
      <div *ngIf="matrix?.length > 1"
           class="price_matrix__btn attention-link"
           data-modal="modalPriceMatrix"
           (click)="isVisible = true"
      >Матрица цен
      </div>
      <ng-container *ngTemplateOutlet="price_matrix_modal"></ng-container>
    </div>
    <ng-container *ngTemplateOutlet="price_matrix"></ng-container>
  </div>


  <div class="product_side" *ngIf="orderStatus === 2">
    <div class="to_cart__wrap">
      <h3>Товар добавлен в <a [routerLink]="['/cart']">корзину</a></h3>
      <p class="to_cart__supplier" *ngIf="isProductPage">от {{tradeOffer?.supplier.name | abbreviatedBusinessName}}</p>
      <ng-container *ngTemplateOutlet="product_side"></ng-container>
      <div class="to_cart__total_price" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
        <span *ngIf="price"
              itemprop="price">{{price | marketMultiplier:'.01' | currencyPrice: tradeOffer.termsOfSale.price?.currencyCode}}</span>
        <span *ngIf="!price" itemprop="price">цена по запросу</span>
      </div>
      <p class="to_cart__nds">{{vatInfo}}</p>
      <p class="to_cart__low_price" *ngIf="isProductPage">НИЗКАЯ ЦЕНА</p>
      <div class="tooltip_wrap" *ngIf="tradeOffer.audience">
        <span class="tooltip"
              nz-tooltip
              nzTooltipTitle="Поставщик установил специальную выгодную цену для вас">Специальная цена</span>
      </div>
      <div *ngIf="matrix?.length > 1"
           class="price_matrix__btn attention-link"
           data-modal="modalPriceMatrix"
           (click)="isVisible = true"
      >Матрица цен
      </div>
      <ng-container *ngTemplateOutlet="price_matrix_modal"></ng-container>
    </div>
    <ng-container *ngTemplateOutlet="price_matrix"></ng-container>
  </div>
</div>

<ng-template #price_matrix_modal>
  <nz-modal #matrixModal nzWrapClassName="test__modal" [(nzVisible)]="isVisible" [nzFooter]="null"
            (nzOnCancel)="isVisible = false">
    <ng-container *ngTemplateOutlet="price_matrix"></ng-container>
  </nz-modal>
</ng-template>

<ng-template #price_matrix>
  <div class="price_matrix" *ngIf="matrix?.length > 1">
    <h3>Матрица цен</h3>
    <div class="price_matrix__group" *ngFor="let item of matrix">
      <span class="price_matrix__label">От {{item.fromPackages}} шт.</span>
      <span
        class="price_matrix__value">{{item.price | marketMultiplier:'.01' | currencyPrice: tradeOffer.termsOfSale.price?.currencyCode}}</span>
      <span class="price_matrix__nds">{{vat}}</span>
    </div>
  </div>
</ng-template>

<ng-template #product_side>
  <div class="side">
    <market-product-side
      [tradeOffer]="tradeOffer"
      [minQuantity]="minQuantity"
      [orderStep]="tradeOffer.termsOfSale.packageMultiplicity"
      (isMadeOrder)="isMadeOrder.emit($event)"
    ></market-product-side>
  </div>
</ng-template>
